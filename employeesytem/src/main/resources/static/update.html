<!DOCTYPE html>
<html>
<head>
    <title>Update Employee</title>
</head>
<body>

<a href="/index.html">Home</a>

<h2>Update Employee</h2>

<form onsubmit="updateEmployee(event)">
    Employee ID: <input type="number" id="id" onblur="fetchEmployee()" required /><br/><br/>
    First Name: <input type="text" id="firstName" required /><br/><br/>
    Last Name: <input type="text" id="lastName" required /><br/><br/>
    Email: <input type="email" id="email" required /><br/><br/>
    Department: <input type="text" id="department" required /><br/><br/>
    Salary: <input type="number" id="salary" required /><br/><br/>

    <button type="submit">Update</button>
</form>

<script>
    async function fetchEmployee() {
            const id = document.getElementById("id").value;
            if (!id) return;

            const response = await fetch(`/api/v1/employees/${id}`);
            if (!response.ok) {
                document.getElementById("firstName").value = "";
                document.getElementById("lastName").value = "";
                document.getElementById("email").value = "";
                document.getElementById("department").value = "";
                document.getElementById("salary").value = "";
                return;
            }

            const emp = await response.json();

            // Auto-fill the form
            document.getElementById("id").value = emp.id;
            document.getElementById("firstName").value = emp.firstName;
            document.getElementById("lastName").value = emp.lastName;
            document.getElementById("email").value = emp.email;
            document.getElementById("department").value = emp.department;
            document.getElementById("salary").value = emp.salary;
    }

    function updateEmployee(e) {
        e.preventDefault();

        const id = document.getElementById("id").value;

        const employee = {
            firstName: document.getElementById("firstName").value,
            lastName: document.getElementById("lastName").value,
            email: document.getElementById("email").value,
            department: document.getElementById("department").value,
            salary: document.getElementById("salary").value
        };

        fetch(`/api/v1/employees/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(employee)
        })
        .then(res => {
            if (res.ok) {
                alert("Employee updated successfully!");
                window.location.href = "/index.html";
            } else {
                return res.text().then(msg => alert("Error: " + msg));
            }
        })
        .catch(err => alert("Error: " + err));
    }
</script>

</body>
</html>
